---
layout: post
title:  "카프카 서버 사용하기(작성중2)"
date:   2023-11-06 23:06:00 +0000
categories: msa
tags: kafka, msa
author: mmmjj
description: msa 카프카 서버 사용하기
---

#### 목적
* 2023.11.08    : kafka 서버를 사용해서 원하는 topic의 update 를 구독 하자
<br><br>

#### 환경
* os,java: window10, jdk 11
* db: mariadb-10.5.22, mariadb-java-client-2.7.2.jar
* kafka: kafka_2.13, confluent-7.3.1, confluentinc-kafka-connect-jdbc-10.6.3
<br><br>

#### Progress
<br>

##### 1. 알맞는 버전의 카프카, 커넥터, db 설치(인스톨러는 따로없고.. 카프카는 압축해제면 됨) 

- 카프카는 적어도 3개로 클러스터를 돌리는데(로컬에서는 zookeeper, controller 돌릴예정) 서버기동순서는 zookeeper -> controller
- 위치: C:\kafka\kafka_2.13-2.7.0
- _[[주의( 카프카 경로를 워크스페이스쪽으로 두려고했으나 커멘드에서 서버기동할때 길이가 너무길다는 에러로그가 발생해서 c밑에 두었다)]]_


* 주키퍼 실행
```
bin\windows\zookeeper-server-start.bat config\zookeeper.properties
```

* 카프카서버
```
bin\windows\kafka-server-start.bat config\server.properties
```

* 토픽생성
```
  bin\windows\kafka-topics.bat --bootstrap-server localhost:9092 --create --topic quickstart-events --partitions 1
```

* 토픽확인
```
bin\windows\kafka-topics.bat --bootstrap-server localhost:9092 --list
```

* 컨슈머확인
```
  bin\windows\kafka-console-consumer.bat --bootstrap-server localhost:9092 --topic quickstart-events --from-beginning
```

* 프로시저테스트
```
  bin\windows\kafka-console-producer.bat --broker-list localhost:9092 --topic quickstart-events
  > inputhere
```

* 프로시저와 컨슈머 <br>
 ![producerTest]({{ site.baseurl }}/assets/images/20231106/producerTest.png){: width="60%" }

<br><br><br>

##### 2. mariadb 커넥트 토픽 추가, 확인  
- 위치: C:\kafka\confluent-7.3.1

- 커낵터실행
```
bin\windows\connect-distributed.bat etc\kafka\connect-distributed.properties
```
- 로컬디비 커낵터 추가(postman사용) <br>
  ![addConnector]({{ site.baseurl }}/assets/images/20231106/addConnector.png){: width="60%" }

- db에 인서트하면 커넥터에서 확인하고 토픽에 쌓음
```
mydb> insert into users(user_id, pwd, name)
      values('user2', 'test222', 'username')
[2023-11-06 22:39:28] 1 row affected in 771 ms
```
![selectTopic]({{ site.baseurl }}/assets/images/20231106/selectTopic.png){: width="60%" }

-- #### result : 


